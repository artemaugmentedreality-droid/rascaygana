<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Loter√≠a Artem - Match 3</title>
    <style>
        :root {
            --green-bg: #2ecc71;
            --deep-purple: #1a0b2e;
            --white: #ffffff;
            --magenta: #d946ef;
            --gold: #FFD700;
        }

        body { 
            margin: 0; padding: 20px 0; 
            background: radial-gradient(circle, #462c7a 0%, #1a0b2e 100%); 
            font-family: 'Segoe UI', sans-serif; color: var(--white);
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .header-logo { margin-bottom: 20px; height: 80px; display: flex; align-items: center; }
        .header-logo img { max-width: 180px; max-height: 70px; object-fit: contain; }

        .billete-container {
            background-color: var(--green-bg);
            padding: 25px 15px;
            border-radius: 25px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.6);
            width: 90%;
            max-width: 360px;
            text-align: center;
            border: 4px solid var(--white);
        }

        .billete-container h2 { 
            margin: 0 0 5px 0; 
            font-size: 24px; 
            text-transform: uppercase; 
            color: var(--white);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .instrucciones { font-size: 14px; margin-bottom: 20px; font-weight: bold; color: #1a0b2e; }

        /* Cuadr√≠cula de 2 columnas x 3 filas */
        .grid-loteria {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            justify-items: center;
        }

        .modulo-rasca {
            position: relative;
            width: 140px;
            height: 140px;
            background: #ffffff;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 2px 2px 10px rgba(0,0,0,0.1);
        }

        .premio-oculto {
            width: 100%; height: 100%;
            display: flex; justify-content: center; align-items: center;
        }

        .premio-oculto img { width: 85%; height: 85%; object-fit: contain; }

        canvas {
            position: absolute;
            top: 0; left: 0;
            touch-action: none;
            cursor: crosshair;
        }

        .btn-action {
            background: linear-gradient(135deg, var(--magenta), #8e54e9);
            color: white; border: none; padding: 18px 35px; border-radius: 35px;
            font-weight: 900; font-size: 16px; margin-top: 25px; cursor: pointer; 
            display: none; text-transform: uppercase;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        /* Modales */
        .overlay { display: none; position: fixed; inset: 0; background: rgba(26, 11, 46, 0.95); z-index: 1000; flex-direction: column; justify-content: center; align-items: center; }
        .caja-blanca { background: white; color: #333; padding: 30px; border-radius: 25px; width: 85%; max-width: 320px; text-align: center; }
        input { width: 100%; padding: 14px; margin: 10px 0; border: 1px solid #ddd; border-radius: 10px; font-size: 16px; box-sizing: border-box; }
        
        .aviso-link { color: var(--magenta); text-decoration: underline; cursor: pointer; }
    </style>
</head>
<body>

    <div class="header-logo">
        <img src="logo-cliente.webp" alt="Artem">
    </div>

    <div class="billete-container">
        <h2>RASCA Y GANA</h2>
        <p class="instrucciones">¬°ENCUENTRA 3 IGUALES PARA GANAR!</p>
        
        <div class="grid-loteria" id="grid-juego">
            </div>

        <button id="btn-reclamar" class="btn-action" onclick="abrirRegistro()">¬°RECLAMAR PREMIO!</button>
        <button id="btn-perdi" class="btn-action" style="background: #95a5a6;" onclick="location.reload()">INTENTAR DE NUEVO</button>
    </div>

    <div id="modal-registro" class="overlay">
        <div class="caja-blanca">
            <h2 style="margin:0; color: var(--deep-purple);">¬°GANASTE!</h2>
            <p id="txt-premio" style="font-weight: 900; color: #d35400; font-size: 1.2rem; margin: 15px 0;"></p>
            
            <input type="text" id="nombre" placeholder="Nombre completo">
            <input type="tel" id="whatsapp" placeholder="WhatsApp (10 d√≠gitos)">
            
            <div style="font-size: 12px; margin: 15px 0; display: flex; align-items: flex-start; gap: 8px; text-align: left;">
                <input type="checkbox" id="aviso" style="width: 20px; margin: 0;"> 
                <label>Acepto el <span class="aviso-link" onclick="togglePriv(true)">aviso de privacidad</span>.</label>
            </div>
            
            <button class="btn-action" style="display:block; width:100%; margin-top: 10px;" onclick="enviarWhatsApp()">CANJEAR POR WHATSAPP</button>
        </div>
    </div>

    <div id="modal-priv" class="overlay" style="z-index: 2000;">
        <div class="caja-blanca" style="text-align: left;">
            <h3 style="margin-top:0;">Aviso de Privacidad</h3>
            <p style="font-size: 14px; line-height: 1.4;">Los datos recabados (Nombre y WhatsApp) se utilizar√°n exclusivamente para validar la entrega de su premio. Al continuar, se iniciar√° un chat en la plataforma WhatsApp.</p>
            <button class="btn-action" style="display:block; width:100%;" onclick="togglePriv(false)">CERRAR</button>
        </div>
    </div>

    <script>
        // CONFIGURACI√ìN DE PREMIOS (Aseg√∫rate de tener premio1.webp, premio2.webp, etc.)
        const PREMIOS_POOL = [
            { id: "premio1", nombre: "10% DE DESCUENTO" },
            { id: "premio2", nombre: "20% DE DESCUENTO" },
            { id: "premio3", nombre: "CERVEZA GRATIS" },
            { id: "premio4", nombre: "POSTRE DE CORTES√çA" },
            { id: "premio5", nombre: "30% EN TODA LA TIENDA" }
        ];

        const CONFIG = {
            tapa: 'tapa-gris.webp',
            probabilidadGarantizada: 0.4 // 40% de probabilidad de ganar
        };

        let casillasReveladas = 0;
        let esGanadorFinal = false;
        let nombrePremioGanado = "";
        let estadosCasillas = new Array(6).fill(false);

        function iniciarJuego() {
            esGanadorFinal = Math.random() < CONFIG.probabilidadGarantizada;
            let esquema = [];

            if (esGanadorFinal) {
                // Seleccionar un premio ganador al azar del pool
                const premioSuerte = PREMIOS_POOL[Math.floor(Math.random() * PREMIOS_POOL.length)];
                nombrePremioGanado = premioSuerte.nombre;
                
                // 3 casillas con el ganador
                esquema = [premioSuerte.id, premioSuerte.id, premioSuerte.id];
                
                // Llenar las otras 3 con premios diferentes (sin repetir 3 veces)
                while(esquema.length < 6) {
                    let randomP = PREMIOS_POOL[Math.floor(Math.random() * PREMIOS_POOL.length)].id;
                    if(randomP !== premioSuerte.id) esquema.push(randomP);
                }
            } else {
                // Caso perdedor: Aseguramos que no haya 3 iguales
                // Usamos un patr√≥n 2, 2, 1, 1
                esquema = [
                    PREMIOS_POOL[0].id, PREMIOS_POOL[0].id, 
                    PREMIOS_POOL[1].id, PREMIOS_POOL[1].id, 
                    PREMIOS_POOL[2].id, PREMIOS_POOL[3].id
                ];
            }

            // Mezclar posiciones
            esquema.sort(() => Math.random() - 0.5);
            crearBillete(esquema);
        }

        function crearBillete(esquema) {
            const grid = document.getElementById('grid-juego');
            esquema.forEach((idPremio, index) => {
                const div = document.createElement('div');
                div.className = 'modulo-rasca';
                div.innerHTML = `
                    <div class="premio-oculto">
                        <img src="${idPremio}.webp" alt="premio">
                    </div>
                    <canvas id="canv-${index}" width="140" height="140"></canvas>
                `;
                grid.appendChild(div);
                prepararCanvas(index);
            });
        }

        function prepararCanvas(index) {
            const canvas = document.getElementById(`canv-${index}`);
            const ctx = canvas.getContext('2d');
            const imgTapa = new Image();
            imgTapa.src = CONFIG.tapa;
            
            imgTapa.onload = () => {
                ctx.drawImage(imgTapa, 0, 0, 140, 140);
            };

            const rascar = (e) => {
                e.preventDefault();
                const rect = canvas.getBoundingClientRect();
                const touch = e.touches ? e.touches[0] : e;
                const x = (touch.clientX - rect.left);
                const y = (touch.clientY - rect.top);

                ctx.globalCompositeOperation = 'destination-out';
                ctx.beginPath();
                ctx.arc(x, y, 25, 0, Math.PI * 2);
                ctx.fill();

                // Verificar si se ha rascado el centro
                if (!estadosCasillas[index]) {
                    const data = ctx.getImageData(70, 70, 1, 1).data;
                    if (data[3] === 0) { // Si el centro es transparente
                        estadosCasillas[index] = true;
                        verificarProgresoGlobal();
                    }
                }
            };

            canvas.addEventListener('mousemove', (e) => { if(e.buttons === 1) rascar(e); });
            canvas.addEventListener('touchmove', rascar);
        }

        function verificarProgresoGlobal() {
            const totalRascadas = estadosCasillas.filter(v => v).length;
            if (totalRascadas === 6) {
                setTimeout(() => {
                    if (esGanadorFinal) {
                        document.getElementById('btn-reclamar').style.display = 'block';
                        document.getElementById('btn-reclamar').scrollIntoView({ behavior: 'smooth' });
                    } else {
                        document.getElementById('btn-perdi').style.display = 'block';
                        alert("¬°Qu√© l√°stima! No encontraste 3 iguales. Int√©ntalo de nuevo.");
                    }
                }, 500);
            }
        }

        function abrirRegistro() {
            document.getElementById('txt-premio').innerText = nombrePremioGanado;
            document.getElementById('modal-registro').style.display = 'flex';
        }

        function togglePriv(val) {
            document.getElementById('modal-priv').style.display = val ? 'flex' : 'none';
        }

        function enviarWhatsApp() {
            const nombre = document.getElementById('nombre').value;
            const tel = document.getElementById('whatsapp').value;
            const aviso = document.getElementById('aviso').checked;

            if (!nombre || tel.length < 10 || !aviso) {
                alert("Por favor, llena todos los campos y acepta el aviso de privacidad.");
                return;
            }

            const mensaje = encodeURIComponent(`*ARTEM LOTER√çA - MATCH 3*\n\nüèÜ PREMIO: ${nombrePremioGanado}\nüë§ CLIENTE: ${nombre}\nüì± TEL: ${tel}`);
            window.location.href = `https://wa.me/5215542492026?text=${mensaje}`;
        }

        // Iniciar al cargar
        window.onload = iniciarJuego;
    </script>
</body>
</html>
